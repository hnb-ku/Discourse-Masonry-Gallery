<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>

<script type="text/discourse-plugin" version="0.8.16">
I18n.translations.en.js.composer.upload_gallery_images = "Upload Gallery Images here";
I18n.translations.en.js.Gallery = "Gallery";

    api.onToolbarCreate(function(toolbar){
      toolbar.addButton({
        trimLeading: true,
        id: 'Gallery',
        group: 'insertions',
        icon: 'picture-o',
        title: 'Gallery',
        perform: function(e){
          return e.applySurround('<div dir="rtl">\n\n', '\n</div>', 'upload_gallery_images')
        }
      });
    })
    

$(document).ajaxComplete(function() {
	var $grid = $('.cooked>div[dir*="rtl"], .cooked>div[dir*="ltr"]');

	$grid.css("visibility", "hidden").imagesLoaded(function() {
		$grid.masonry({
				itemSelector: ".lightbox-wrapper"
			}).css("visibility", "visible");
	});
});
</script>

